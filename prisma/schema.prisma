// Prisma schema for DogAtlas
// Adjust field types and relations as needed for your app

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  role      String   @default("USER")
  points    Int      @default(0)
  reviews   Review[]
  submissions Submission[]
  places    Place[]  @relation("UserPlaces")
  photos    Photo[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Place {
  id          String         @id @default(uuid())
  city        String
  name        String
  slug        String
  category    String
  description String?
  address     String?
  district    String?
  neighborhood String?
  lat         Float?
  lng         Float?
  website     String?
  phone       String?
  priceLevel  String?
  rating      Float?
  ratingCount Int?
  status      String        @default("pending")
  features    PlaceFeature[]
  hours       PlaceHour[]
  activities  Activity[]
  photos      Photo[]
  reviews     Review[]
  submissions Submission[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  user        User?         @relation("UserPlaces", fields: [userId], references: [id])
  userId      String?

  @@unique([city, slug])
}

model PlaceFeature {
  id      String  @id @default(uuid())
  key     String
  value   String
  place   Place   @relation(fields: [placeId], references: [id])
  placeId String
}

model PlaceHour {
  id      String  @id @default(uuid())
  day     String
  open    String
  close   String
  place   Place   @relation(fields: [placeId], references: [id])
  placeId String
}

model Photo {
  id        String   @id @default(uuid())
  url       String
  place     Place    @relation(fields: [placeId], references: [id])
  placeId   String
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  createdAt DateTime @default(now())
}

model Review {
  id        String   @id @default(uuid())
  place     Place    @relation(fields: [placeId], references: [id])
  placeId   String
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  rating    Int
  body      String?
  tags      String[]
  status    String   @default("pending")
  createdAt DateTime @default(now())
}

model Submission {
  id        String   @id @default(uuid())
  type      String
  payload   Json
  place     Place?   @relation(fields: [placeId], references: [id])
  placeId   String?
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  status    String   @default("pending")
  createdAt DateTime @default(now())
}

model Activity {
  id        String   @id @default(uuid())
  type      String
  attrs     Json
  place     Place    @relation(fields: [placeId], references: [id])
  placeId   String
}

model Sponsor {
  id        String   @id @default(uuid())
  name      String
  url       String?
  createdAt DateTime @default(now())
}

model AnalyticsEvent {
  id          String   @id @default(uuid())
  eventType   String   // page_view, place_view, search, category_click, etc.
  eventData   Json?    // Additional event-specific data
  userId      String?  // Track authenticated users
  sessionId   String   // Track anonymous sessions
  ipAddress   String?
  userAgent   String?
  page        String   // Current page path
  referrer    String?  // Referring page
  city        String?  // City context (berlin, etc.)
  category    String?  // Category context if applicable
  placeId     String?  // Place ID if viewing a place
  searchQuery String?  // Search term if applicable
  deviceType  String?  // mobile, desktop, tablet
  browser     String?  // Chrome, Safari, Firefox, etc.
  country     String?  // User's country
  createdAt   DateTime @default(now())

  @@index([eventType, createdAt])
  @@index([city, createdAt])
  @@index([sessionId])
  @@index([userId])
}

model AnalyticsSession {
  id          String   @id @default(uuid())
  sessionId   String   @unique
  userId      String?
  startedAt   DateTime @default(now())
  lastSeenAt  DateTime @default(now())
  pageViews   Int      @default(0)
  city        String?
  entryPage   String
  exitPage    String?
  duration    Int?     // Session duration in seconds
  deviceType  String?
  browser     String?
  country     String?
  ipAddress   String?
  userAgent   String?
}
